<!DOCTYPE html>
<html>

<head>
    <title>Location</title>

    <script src="https://code.jquery.com/jquery-3.1.1.min.js"></script>
    <script>

        function refresh_rows() {
            console.log('fetching rows');
            $.ajax({
                url:         'https://127.0.0.1:8080/hoppers/rest/locations',
                type:        "GET",
                contentType: "application/json;",
                success:     function (msg) {
                    json_response = jQuery.parseJSON(msg);
                    $('#rows_holder').empty();
                    $('#rows_holder').append( '<table id="rows_table"></table>' );
                    for (var i = 0; i < json_response.length; i++) {
                        console.log(json_response[i]);
                        $('#rows_table').append('<tr id="rows_table_' + i.toString() + '"></tr>');
                        for (var key in json_response[i]) {
                            if (json_response[i].hasOwnProperty(key)) {
                                $('#rows_table_'+i.toString()).append('<td>'+json_response[i][key].toString()+'</td>');
                                console.log(key + " -> " + json_response[i][key]);
                            }
                        }
                        $('#rows_table_'+i.toString()).append('<td><a href="#" id="rows_table_edit' + i.toString() + '_id">Edit</a></td>');
                        $('#rows_table_edit'+i.toString()+'_id').click({p1: json_response, p2: i}, function(event) {
                            value = $('#location_name').val();
                            data = { 'location_name': value };
                            $.ajax({
                                url:         'https://127.0.0.1:8080/hoppers/rest/locations/'+event.data.p1[event.data.p2].location_id.toString(),
                                type:        "PUT",
                                contentType: "application/json;",
                                data:        JSON.stringify(data),
                                dataType:    "json",
                                success:     function (msg) {
                                    console.log(msg);
                                    refresh_rows();
                                },
                                error:       function (err){
                                    console.log(err)
                                    refresh_rows();
                                }
                            });
                            return false;
                        });
                        $('#rows_table_'+i.toString()).append('<td><a href="#" id="rows_table_delete' + i.toString() + '_id">Delete</a></td>');
                        $('#rows_table_delete'+i.toString()+'_id').click({p1: json_response, p2: i}, function(event) {
                            value = $('#location_name').val();
                            data = { 'location_name': value };
                            $.ajax({
                                url:         'https://127.0.0.1:8080/hoppers/rest/locations/'+event.data.p1[event.data.p2].location_id.toString(),
                                type:        "DELETE",
                                contentType: "application/json;",
                                success:     function (msg) {
                                    console.log(msg);
                                    refresh_rows();
                                },
                                error:       function (err){
                                    console.log(err)
                                    refresh_rows();
                                }
                            });
                            return false;
                        });
                    }
                },
                error:       function (err){
                    console.log(err)
                    alert('GET Error');
                }
            });
        };

        $(document).ready(function() {
            /* attach a submit handler to the form */
            $('#add_button').click(function() {
                value = $('#location_name').val();
                console.log(value);
                data = { 'location_name': value };
                console.log(data);
                $.ajax({
                    url:         'https://127.0.0.1:8080/hoppers/rest/locations/',
                    type:        "POST",
                    contentType: "application/json;",
                    data:        JSON.stringify(data),
                    dataType:    "json",
                    success:     function (msg) {
                        console.log(msg);
                        refresh_rows();
                    },
                    error:       function (err){
                        console.log(err)
                        refresh_rows();
                    }
                });
            });

            refresh_rows();
        });
    </script>

</head>

<body>
    <h1>Locations</h1>
    <div id="rows_holder">
    </div>
    <p>Location Name: <input type="text" name="location_name" id="location_name"/><button id="add_button">Add</button></p>
<!--
    <button id="edit_button">Edit</button>
    <button id="delete_button">Delete</button>
-->
</body>

</html>
